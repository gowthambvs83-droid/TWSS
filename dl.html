<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>OTP Verification ‚Äî TWSS</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- EmailJS CDN -->
  <script src="https://cdn.emailjs.com/dist/email.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
    }
    .card {
      background: #fff;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.1);
      max-width: 400px;
      width: 100%;
      text-align: center;
    }
    input, button {
      width: 100%;
      padding: 0.7rem;
      margin: 0.5rem 0;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    button {
      background: #2563eb;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:disabled { opacity: 0.6; cursor: not-allowed; }
    .success { color: green; font-weight: bold; }
    .error { color: red; font-weight: bold; }
    #otpBox, #downloadBox { display: none; }
    .download-btn {
      display: inline-block;
      background: #0ea5e9;
      color: #fff;
      padding: 0.7rem 1.2rem;
      border-radius: 8px;
      text-decoration: none;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <div class="card">
    <h2>OTP Verification</h2>
    <div id="status"></div>

    <!-- Step 1: Enter email -->
    <div id="emailBox">
      <input type="email" id="emailInput" placeholder="Enter your email">
      <button id="sendOtpBtn">Send OTP</button>
    </div>

    <!-- Step 2: Enter OTP -->
    <div id="otpBox">
      <input type="text" id="otpInput" placeholder="Enter OTP" maxlength="6">
      <button id="verifyOtpBtn">Verify OTP</button>
      <div id="otpMsg"></div>
    </div>

    <!-- Step 3: Download -->
    <div id="downloadBox">
      <p class="success">‚úÖ OTP verified! You can now download your duty leave.</p>
      <a id="downloadLink" class="download-btn"
         href="https://twss.netlify.app/Screenshot 2025-08-27 005537.png" download>Download Duty Leave</a>
    </div>
  </div>

<script>
/* --- CONFIG (your EmailJS details) --- */
const EMAILJS_PUBLIC_KEY  = "Kvw3qwiz3bt3Xutlf"; 
const EMAILJS_SERVICE_ID  = "service_o3hfoip";     
const EMAILJS_TEMPLATE_ID = "template_0lscxdn";    

/* --- INIT --- */
emailjs.init(EMAILJS_PUBLIC_KEY);

let currentOtp = null;
let otpExpiry  = 0;

const statusEl = document.getElementById("status");
const emailEl  = document.getElementById("emailInput");
const sendBtn  = document.getElementById("sendOtpBtn");
const otpBox   = document.getElementById("otpBox");
const otpEl    = document.getElementById("otpInput");
const verifyBtn= document.getElementById("verifyOtpBtn");
const otpMsg   = document.getElementById("otpMsg");
const downloadBox = document.getElementById("downloadBox");

function setStatus(msg,type=""){statusEl.textContent=msg;statusEl.className=type;}
function makeOtp(){return String(Math.floor(100000+Math.random()*900000));}

/* --- SEND OTP --- */
sendBtn.addEventListener("click", async ()=>{
  const email = emailEl.value.trim();
  if(!email){ setStatus("‚ùå Please enter an email","error"); return; }

  setStatus("‚è≥ Sending OTP...");
  sendBtn.disabled = true;

  try {
    currentOtp = makeOtp();
    otpExpiry = Date.now() + 15 * 60 * 1000; // 15 mins

    await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {
      email: email,
      passcode: currentOtp,
      time: new Date(otpExpiry).toLocaleTimeString()
    });

    setStatus("üì© OTP sent to "+email,"success");
    otpBox.style.display="block";
  } catch(err) {
    console.error("EmailJS error:", err);
    setStatus("‚ùå Failed to send OTP. (Check console)","error");
  } finally {
    sendBtn.disabled = false;
  }
});

/* --- VERIFY OTP --- */
verifyBtn.addEventListener("click", ()=>{
  const entered = otpEl.value.trim();
  if(!currentOtp){ otpMsg.textContent="Send OTP first."; return; }
  if(Date.now()>otpExpiry){ otpMsg.textContent="OTP expired."; return; }
  if(entered===currentOtp){
    otpMsg.textContent="‚úÖ OTP verified.";
    setStatus("OTP verified!","success");
    downloadBox.style.display="block";
    otpBox.style.display="none";
  } else {
    otpMsg.textContent="‚ùå Wrong OTP.";
  }
});
</script>
<!-- Use the NEW SDK -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<script>
  emailjs.init("Kvw3qwiz3bt3Xutlf");

  async function sendOtp() {
    const otp = Math.floor(100000 + Math.random() * 900000);
    try {
      await emailjs.send("service_o3hfoip", "template_0lscxdn", {
        email: "student@college.edu",
        passcode: otp,
        time: new Date().toLocaleTimeString()
      });
      alert("OTP sent: " + otp);
    } catch (err) {
      console.error("EmailJS error:", err);
      alert("Failed to send OTP: " + err.text);
    }
  }
</script>
<script>
    document.onkeydown = function(e) {
        if (
            e.ctrlKey && (e.key === 'u' || e.key === 'U' || e.key === 's' || e.key === 'S') ||
            e.key === 'F12' ||
            (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'i'))
        ) {
            return false;
        }
    };
    document.addEventListener('contextmenu', event => {
        event.preventDefault();
    });
    </script>
</body>
</html>
